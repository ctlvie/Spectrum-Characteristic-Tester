/*=======================================================
Author				  :				ctlvie
Email Address		  :				ctlvie@gmail.com
Filename			  :				LCD12864.c
Date				  :			    2018-11-19
Description			  :				12864液晶屏驱动(串行)

Modification History:
Date		By			Version		Description
----------------------------------------------------------
181119		ctlvie		1.0			字符、汉字显示和清屏函数
181120		ctlvie		1.1			打点、画线函数
========================================================*/
#include<msp430f5529.h>
#include"LCD12864.h"
 

uchar LCD_GraphBuff[] =
{
/*--  调入了一幅图像：C:\Documents and Settings\Administrator\桌面\1.bmp  --*/
/*--  宽度x高度=128x64  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

uchar LCD_ChineseBuff[]=
{
	"频谱特性测试"
	"Tester"
	""
	"123.58Mhz"
};

void DelayUs2x(uchar t)
{   
 while(--t);
}
 
void DELAY_LCD_MS(uchar t)
{
     
 while(t--)
 {
     //大致延时1mS
     DelayUs2x(245);
	 DelayUs2x(245);
 }
}

//-------------------------------------------------
//Name:     	SendByte(uchar zdata)    
//Description:  向LCD12864发送1Byte数据
//Input:        uchar zdata : 需要发送的数据
//Output:       无
//------------------------------------------------- 
void SendByte(uchar zdata)
{
	unsigned int i;
	
	for(i=0; i<8; i++)
	{
		if((zdata << i) & 0x80)
		{
			SID1;
		}
		else
		{
			SID0;
		}
		SCLK0;
		SCLK1;
	}
}


//-------------------------------------------------
//Name:      	WriteCommand(uchar cmdcode) 
//Description: 	向LCD12864发送命令 
//Input:        uchar cmdcode : 命令代码
//Output:       无
//------------------------------------------------- 
void WriteCommand(uchar cmdcode)
{
	CS1;
	SendByte(0xf8);   //1 1 1 1 RS RW 0   写操作RW=0 11111000写数据 11111010写指令
	SendByte(cmdcode & 0xf0);
	SendByte((cmdcode << 4) & 0xf0);
	DELAY_LCD_MS(1);
	CS0;
}
 

//-------------------------------------------------
//Name:         WriteData(uchar Dispdata)
//Description:  向LCD12864发送数据
//Input:        uchar Dispdata : 需要发送的数据
//Output:       无
//------------------------------------------------- 
void WriteData(uchar Dispdata)
{
	CS1;
	SendByte(0xfa);
	SendByte(Dispdata & 0xf0);
	SendByte((Dispdata << 4) & 0xf0);
	DELAY_LCD_MS(1);
	CS0;
}


//-------------------------------------------------
//Name:     	initLCD()    
//Description:  LCD12864初始化函数
//Input:        无
//Output:       无
//------------------------------------------------- 
void initLCD()
{
    IO_LCD_DIR = 0xFF;
    IO_LCD_OUT = 0x00;
	DELAY_LCD_MS(200);
	WriteCommand(0x30);  //功能设定：基本指令集
	DELAY_LCD_MS(20);
	WriteCommand(0x0c);  //显示状态：整体显示，游标关
	DELAY_LCD_MS(20);
	WriteCommand(0x01);  //清空显示
	DELAY_LCD_MS(200);
}


//-------------------------------------------------
//Name:         LCD_clearCommand(void)
//Description:  发送清屏命令(0x01)
//Input:        无
//Output:       无
//------------------------------------------------- 
 void LCD_clearCommand(void)
 {
     WriteCommand(0x01);
     DELAY_LCD_MS(100);
 }


//-------------------------------------------------
//Name:         LCD_clearScreen(void)
//Description:  清空整个屏幕(以绘制空白图像的方式)
//Input:        无
//Output:       无
//------------------------------------------------- 
 void LCD_clearScreen(void)
 {
     LCD_disString(1,1,"                    ");
     LCD_disString(1,2,"                    ");
	 LCD_disString(1,3,"                    ");
	 LCD_disString(1,4,"                    ");
 }

//=======================================================
//Tips: LCD_disXXX  为直接在LCD12864上进行显示的各类函数
//		LCD_drawXXX 为修改LCD_GraphBuff的各类函数,需要在绘制完成后调用LCD_disGraph(void)将其显示在LCD12864的屏幕上

//-------------------------------------------------
//Name:         LCD_disString(unsigned int x,unsigned int y,uchar* s)
//Description:  显示字符
//Input:        unsigned int x :	字符显示位置的x坐标
//				unsigned int y:		字符显示位置的y坐标
//				uchar* s:	需要显示的字符
//Output:       无
//------------------------------------------------- 
void LCD_disString(unsigned int x,unsigned int y,uchar* s)
{
	 switch(y)
     {
	  case 1: WriteCommand(0x80+x);break;
	  case 2: WriteCommand(0x90+x);break;
	  case 3: WriteCommand(0x88+x);break;
	  case 4: WriteCommand(0x98+x);break;
      default:break;
	 }
    while(*s>0)
   { 
      WriteData(*s);
      s++;
      DelayUs2x(50);
   }
}


//-------------------------------------------------
//Name:         LCD_disGBStr(uchar *LCD_ChineseBuff)
//Description:  显示中文字符
//Input:        uchar *LCD_ChineseBuff : 需要显示的中文存放在此uchar数组中
//Output:       无
//------------------------------------------------- 
 void LCD_disGBStr(uchar *LCD_ChineseBuff)
{
	uchar uc_GBCnt;

	WriteCommand(0x30); 	//DL=1:8-BIT interface
	WriteCommand(0x30); 	//RE=0:basic instruction
	WriteCommand(0x0C); 	//Display OFF,Cursor OFF,Cursor position blink OFF

	WriteCommand(0x80);
	for (uc_GBCnt=0;uc_GBCnt<16;uc_GBCnt++)
	{
		WriteData(LCD_ChineseBuff[2 * uc_GBCnt]);
		WriteData(LCD_ChineseBuff[2 * uc_GBCnt + 1]);
	};

	WriteCommand(0x90);
	for (uc_GBCnt=0;uc_GBCnt<16;uc_GBCnt++)
	{
		WriteData(LCD_ChineseBuff[2 * uc_GBCnt + 32]);
		WriteData(LCD_ChineseBuff[2 * uc_GBCnt + 33]);
	};

	DELAY_LCD_MS(20);
}


//-------------------------------------------------
//Name:         LCD_disPic(uchar *xc_PicArea)
//Description:  显示图片(用于取模后图片的整体显示)
//Input:        uchar *xc_PicArea : 图片取模后存放在此uchar数组中
//Output:       无
//------------------------------------------------- 
void LCD_disPic(uchar *xc_PicArea)
{
	uchar uc_HorAddr,uc_VerAddr;
	uchar uc_VerCnt,uc_HorCnt;

	uc_VerAddr=0x80;	
	uc_HorAddr=0x80;

	WriteCommand(0x36);
	WriteCommand(0x36);
	
	for (uc_VerCnt=0;uc_VerCnt<32;uc_VerCnt++)
	{
		WriteCommand(uc_VerAddr + uc_VerCnt);
		WriteCommand(uc_HorAddr);
		
		for (uc_HorCnt=0;uc_HorCnt<16;uc_HorCnt++)
			WriteData(xc_PicArea[uc_VerCnt*16 + uc_HorCnt ]);

		for (uc_HorCnt=0;uc_HorCnt<16;uc_HorCnt++)
			WriteData(xc_PicArea[16*32 +uc_VerCnt*16 + uc_HorCnt ]);
	};
	DELAY_LCD_MS(20);
}


//-------------------------------------------------
//Name:         LCD_disGraph(void)
//Description:  显示图像(全局变量 uchar LCD_GraphBuff[] 对应的图像)
//Input:        无
//Output:       无
//------------------------------------------------- 
void LCD_disGraph(void)
{
	uchar uc_HorAddr,uc_VerAddr;
	uchar uc_VerCnt,uc_HorCnt;

	uc_VerAddr=0x80;	
	uc_HorAddr=0x80;

	WriteCommand(0x36);
	WriteCommand(0x36);
	
	for (uc_VerCnt=0;uc_VerCnt<32;uc_VerCnt++)
	{
		WriteCommand(uc_VerAddr + uc_VerCnt);
		WriteCommand(uc_HorAddr);
		
		for (uc_HorCnt=0;uc_HorCnt<16;uc_HorCnt++)
			WriteData(LCD_GraphBuff[uc_VerCnt*16 + uc_HorCnt ]);

		for (uc_HorCnt=0;uc_HorCnt<16;uc_HorCnt++)
			WriteData(LCD_GraphBuff[16*32 +uc_VerCnt*16 + uc_HorCnt ]);
	};
	DELAY_LCD_MS(20);
}


//-------------------------------------------------
//Name:        	LCD_drawPoints(int x_pos, int y_pos,uint color) 
//Description:  绘制任意点
//Input:        int x_pos :		点的 x 坐标
//				int y_pos :		点的 y 坐标
//				uint color :	点的颜色( 1为显示; 0为不显示)
//Output:       无
//------------------------------------------------- 
void LCD_drawPoints(int x_pos, int y_pos,uint color)
{
	 int buff_x, buff_y, offset, buff_number ;
	 int currBuff;
	 buff_x = x_pos / 8 ;
	 offset = x_pos % 8 ;
	 //offset = x_pos % 8 - 1 ;
	 buff_y = y_pos - 1 ;
	 buff_number = buff_y * 16 +buff_x ;
	 if(color)
	 {
		 currBuff = LCD_GraphBuff[buff_number] ;
		 switch(offset)
		 {
			case 0:	currBuff = currBuff | 0b10000000; break;
			case 1:	currBuff = currBuff | 0b01000000; break;
			case 2:  currBuff = currBuff | 0b00100000; break;
			case 3:  currBuff = currBuff | 0b00010000; break;
			case 4:  currBuff = currBuff | 0b00001000; break;
			case 5:  currBuff = currBuff | 0b00000100; break;
			case 6:  currBuff = currBuff | 0b00000010; break;
			case 7:  currBuff = currBuff | 0b00000001; break;
		 }
		 LCD_GraphBuff[buff_number] = currBuff;
	 }
	 else
	 {
		 currBuff = LCD_GraphBuff[buff_number] ;
		 switch(offset)
		 {
			case 0:	currBuff = currBuff & 0b01111111; break;
			case 1:	currBuff = currBuff & 0b10111111; break;
			case 2:  currBuff = currBuff & 0b11011111; break;
			case 3:  currBuff = currBuff & 0b11101111; break;
			case 4:  currBuff = currBuff & 0b11110111; break;
			case 5:  currBuff = currBuff & 0b11111011; break;
			case 6:  currBuff = currBuff & 0b11111101; break;
			case 7:  currBuff = currBuff & 0b11111110; break;
		 }
		 LCD_GraphBuff[buff_number] = currBuff;
	 }
}


//-------------------------------------------------
//Name:         void LCD_drawLine_X(uchar X0,uchar X1,uchar Y,uchar Color)
//Description:  绘制水平直线(y坐标不改变)
//Input:        uchar X0 :	起点的 x 坐标
//				uchar X1: 	终点的 x 坐标
//				uchar Y:	直线的 y 坐标
//				uchar Color: 颜色( 1为显示; 0为不显示)
//Output:       无
//------------------------------------------------- 
void LCD_drawLine_X(uchar X0,uchar X1,uchar Y,uchar Color)
{
	uchar temp;
	if (X0>X1)
	{
		temp=X1;
		X1=X0;
		X0=temp;
	}
	for(;X0<X1;X0++)
		LCD_drawPoints(X0,Y,Color);
}


//-------------------------------------------------
//Name:         void LCD_drawLine_Y(uchar X,uchar Y0,uchar Y1,uchar Color)
//Description:  绘制水平直线(y坐标不改变)
//Input:      	uchar X:	直线的 x 坐标
//				uchar Y0 :	起点的 y 坐标
//				uchar Y1: 	终点的 y 坐标	
//				uchar Color: 颜色( 1为显示; 0为不显示)
//Output:       无     
//------------------------------------------------- 
void LCD_drawLine_Y(uchar X,uchar Y0,uchar Y1,uchar Color)
{
	uchar temp;
	if (Y0>Y1)
	{
		temp=Y1;
		Y1=Y0;
		Y0=temp;
	}
	for(;Y0<Y1;Y0++)
		LCD_drawPoints(X,Y0,Color);
}


//-------------------------------------------------
//Name:         LCD_drawLine(uchar X0,uchar Y0,uchar X1,uchar Y1,uchar Color)
//Description:  绘制任意直线
//Input:        uchar X0 :	起点的 x 坐标
//				uchar Y0 :	起点的 y 坐标
//				uchar X1 :	终点的 x 坐标
//				uchar Y1 :	终点的 y 坐标
//Output:       无
//------------------------------------------------- 
void LCD_drawLine(uchar X0,uchar Y0,uchar X1,uchar Y1,uchar Color)
{
	int t,distance;
	int x=0,y=0,delta_x,delta_y;
	int incx,incy;
	delta_x=X1-X0;
	delta_y=Y1-Y0;
	if(delta_x>0)
		incx=1;
	else if(delta_x==0)
	{
		LCD_drawLine_Y(X0,Y0,Y1,Color);
		return ;
	}
	else
		incx=-1;

	if(delta_y>0)
		incy=1;
	else if(delta_y==0)
	{
		LCD_drawLine_X(X0,X1,Y0,Color);
		return ;
	}
	else
		incy=-1;

	delta_x=fabs(delta_x);
	delta_y=fabs(delta_y);
	if(delta_x>delta_y)
		distance=delta_x;
	else
		distance = delta_y;

	LCD_drawPoints(X0,Y0,Color);
	for(t=0;t<=distance+1;t++)
	{
		LCD_drawPoints(X0,Y0,Color);
		x+=delta_x;
		y+=delta_y;
		if(x>distance)
		{
			x-=distance;
			X0+=incx;
		}
		if(y>distance )
		{
			y-=distance;
			Y0+=incy;
		}
	}
}
