/*=======================================================
Author				  :				ctlvie
Email Address		  :				ctlvie@gmail.com
Filename			  :				LCD12864.c
Date				  :			    2018-11-19
Description			  :				12864液晶屏驱动

Modification History:
Date		By			Version		Description
----------------------------------------------------------
181119		ctlvie		1.0			字符、汉字显示和清屏函数
========================================================*/
#include<msp430f5529.h>
#include"LCD12864.h"
 

uchar LCD_BUFF[] =
{
/*--  调入了一幅图像：C:\Documents and Settings\Administrator\桌面\1.bmp  --*/
/*--  宽度x高度=128x64  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

uchar CorpInf[]=
{
	"频谱特性测试"
	"Tester"
	""
	"123.58Mhz"
};

void DelayUs2x(unsigned char t)
{   
 while(--t);
}
 
void DELAY_LCD_MS(unsigned char t)
{
     
 while(t--)
 {
     //大致延时1mS
     DelayUs2x(245);
	 DelayUs2x(245);
 }
}
 
void SendByte(unsigned char zdata)
{
	unsigned int i;
	
	for(i=0; i<8; i++)
	{
		if((zdata << i) & 0x80)
		{
			SID1;
		}
		else
		{
			SID0;
		}
		SCLK0;
		SCLK1;
	}
}

uchar ReadByte(void)
{
	uchar temp1=0,temp2=0,i;
	for(i=0;i<8;i++)
	{
		temp1=temp1<<1;
		SCLK0;
		SCLK1;
		SCLK0;
		IO_LCD_DIR &=~ IO_LCD_BIT_SID;
		if(IO_LCD_IN & IO_LCD_BIT_SID)
		{
			temp1++;
		}
		IO_LCD_DIR |= IO_LCD_BIT_SID;
	}
	for(i=0;i<8;i++)
	{
		temp2=temp2<<1;
		SCLK0;
		SCLK1;
		SCLK0;
		IO_LCD_DIR &=~ IO_LCD_BIT_SID;
		if(IO_LCD_IN & IO_LCD_BIT_SID)
		{
			temp2++;
		}
		IO_LCD_DIR |= IO_LCD_BIT_SID;	
	}
	return ((0xf0&temp1)+(0x0f&temp2));
}

 
void WriteCommand(unsigned char cmdcode)
{
	CS1;
	SendByte(0xf8);   //1 1 1 1 RS RW 0   写操作RW=0 11111000写数据 11111010写指令
	SendByte(cmdcode & 0xf0);
	SendByte((cmdcode << 4) & 0xf0);
	DELAY_LCD_MS(1);
	CS0;
}
 
void WriteData(unsigned char Dispdata)
{
	CS1;
	SendByte(0xfa);
	SendByte(Dispdata & 0xf0);
	SendByte((Dispdata << 4) & 0xf0);
	DELAY_LCD_MS(1);
	CS0;
}
 
void initLCD()
{
    IO_LCD_DIR = 0xFF;
    IO_LCD_OUT = 0x00;
	DELAY_LCD_MS(200);
	WriteCommand(0x30);  //功能设定：基本指令集
	DELAY_LCD_MS(20);
	WriteCommand(0x0c);  //显示状态：整体显示，游标关
	DELAY_LCD_MS(20);
	WriteCommand(0x01);  //清空显示
	DELAY_LCD_MS(200);
}
 
 void LCD_clearAll(void)
 {
     WriteCommand(0x01);
     DELAY_LCD_MS(100);
 }
  
void LCD_disString(unsigned int x,unsigned int y,unsigned char* s)
{
	 switch(y)
     {
	  case 1: WriteCommand(0x80+x);break;
	  case 2: WriteCommand(0x90+x);break;
	  case 3: WriteCommand(0x88+x);break;
	  case 4: WriteCommand(0x98+x);break;
      default:break;
	 }
    while(*s>0)
   { 
      WriteData(*s);
      s++;
      DelayUs2x(50);
   }
}

 void LCD_disGBStr(uchar *CorpInf)
{
	uchar uc_GBCnt;

	WriteCommand(0x30); 	//DL=1:8-BIT interface
	WriteCommand(0x30); 	//RE=0:basic instruction
	WriteCommand(0x0C); 	//Display OFF,Cursor OFF,Cursor position blink OFF

	WriteCommand(0x80);
	for (uc_GBCnt=0;uc_GBCnt<16;uc_GBCnt++)
	{
		WriteData(CorpInf[2 * uc_GBCnt]);
		WriteData(CorpInf[2 * uc_GBCnt + 1]);
	};

	WriteCommand(0x90);
	for (uc_GBCnt=0;uc_GBCnt<16;uc_GBCnt++)
	{
		WriteData(CorpInf[2 * uc_GBCnt + 32]);
		WriteData(CorpInf[2 * uc_GBCnt + 33]);
	};

	DELAY_LCD_MS(20);
}

void LCD_disPic(uchar *xc_PicArea)
{
	uchar uc_HorAddr,uc_VerAddr;
	uchar uc_VerCnt,uc_HorCnt;

	uc_VerAddr=0x80;	
	uc_HorAddr=0x80;

	WriteCommand(0x36);
	WriteCommand(0x36);
	
	for (uc_VerCnt=0;uc_VerCnt<32;uc_VerCnt++)
	{
		WriteCommand(uc_VerAddr + uc_VerCnt);
		WriteCommand(uc_HorAddr);
		
		for (uc_HorCnt=0;uc_HorCnt<16;uc_HorCnt++)
			WriteData(xc_PicArea[uc_VerCnt*16 + uc_HorCnt ]);

		for (uc_HorCnt=0;uc_HorCnt<16;uc_HorCnt++)
			WriteData(xc_PicArea[16*32 +uc_VerCnt*16 + uc_HorCnt ]);
	};
	DELAY_LCD_MS(20);
}

void LCD_disBuff(uchar *xc_PicArea)
{
	uchar uc_HorAddr,uc_VerAddr;
	uchar uc_VerCnt,uc_HorCnt;

	uc_VerAddr=0x80;	
	uc_HorAddr=0x80;

	WriteCommand(0x36);
	WriteCommand(0x36);
	
	for (uc_VerCnt=0;uc_VerCnt<32;uc_VerCnt++)
	{
		WriteCommand(uc_VerAddr + uc_VerCnt);
		WriteCommand(uc_HorAddr);
		
		for (uc_HorCnt=0;uc_HorCnt<16;uc_HorCnt++)
			WriteData(xc_PicArea[uc_VerCnt*16 + uc_HorCnt ]);

		for (uc_HorCnt=0;uc_HorCnt<16;uc_HorCnt++)
			WriteData(xc_PicArea[16*32 +uc_VerCnt*16 + uc_HorCnt ]);
	};
	DELAY_LCD_MS(20);
}

void LCD_drawDots(int x_pos, int y_pos,uint color)
{
	 int buff_x, buff_y, offset, buff_number ;
	 int currBuff;
	 buff_x = x_pos / 8 ;
	 offset = x_pos % 8 - 1 ;
	 buff_y = y_pos - 1 ;
	 buff_number = buff_y * 16 +buff_x ;
	 if(color)
	 {
		 currBuff = LCD_BUFF[buff_number] ;
		 switch(offset)
		 {
			case 0:	currBuff = currBuff | 0b10000000; break;
			case 1:	currBuff = currBuff | 0b01000000; break;
			case 2:  currBuff = currBuff | 0b00100000; break;
			case 3:  currBuff = currBuff | 0b00010000; break;
			case 4:  currBuff = currBuff | 0b00001000; break;
			case 5:  currBuff = currBuff | 0b00000100; break;
			case 6:  currBuff = currBuff | 0b00000010; break;
			case 7:  currBuff = currBuff | 0b00000001; break;
		 }
		 LCD_BUFF[buff_number] = currBuff;
	 }
	 else
	 {
		 currBuff = LCD_BUFF[buff_number] ;
		 switch(offset)
		 {
			case 0:	currBuff = currBuff & 0b01111111; break;
			case 1:	currBuff = currBuff & 0b10111111; break;
			case 2:  currBuff = currBuff & 0b11011111; break;
			case 3:  currBuff = currBuff & 0b11101111; break;
			case 4:  currBuff = currBuff & 0b11110111; break;
			case 5:  currBuff = currBuff & 0b11111011; break;
			case 6:  currBuff = currBuff & 0b11111101; break;
			case 7:  currBuff = currBuff & 0b11111110; break;
		 }
		 LCD_BUFF[buff_number] = currBuff;
	 }
}

